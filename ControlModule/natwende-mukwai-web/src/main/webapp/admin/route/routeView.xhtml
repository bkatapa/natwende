<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
				xmlns:ui="http://java.sun.com/jsf/facelets"
				template="/layout/templatePage.xhtml"
				xmlns:p="http://primefaces.org/ui"
				xmlns:h="http://java.sun.com/jsf/html"
				xmlns:f="http://java.sun.com/jsf/core"
				xmlns:pe="http://primefaces.org/ui/extensions"
				xmlns:o="http://omnifaces.org/ui"
				xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
				
	<ui:define name="content">
	
		<h:form id="newRoute-form">
			
			<p:messages severity="info,error" autoUpdate="true" showIcon="true" closable="true" />
			
			<p:steps activeIndex="#{RouteAction.currentStep}"
					 styleClass="custom"
					 style="margin-top: 20px; margin-bottom: 20px;">
			 	<p:menuitem value="Loading station" />
			 	<p:menuitem value="Final destination" />
			 	<p:menuitem value="Transit stations" />
			 	<p:menuitem value="Re-order transit stations" />
			 	<p:menuitem value="Travel time estimates" />
			 	<p:menuitem value="Confirm" />
		 	</p:steps>
		 	
		 	<p:panel id="step1" header="Specify loading station" rendered="#{RouteAction.currentStep eq 0}" style="margin-top: 70px;">
		 		<p:selectOneMenu id="newRoute-start" value="#{RouteAction.selectedEntity.start}" converter="#{StopVOConverter}">
		 			<f:selectItems value="#{RouteAction.stationList}"
	 							   var="start"
	 							   itemValue="#{start}"
	 							   itemLabel="#{start}" />
			   		<p:ajax process="step1" update="newRoute-form" />
		 		</p:selectOneMenu>
		 		
		 		<p:toolbar style="border: none; margin-top: 5px;">
		 			<p:toolbarGroup align="left">
		 				<p:commandButton ajax="true"
		 								 process="@this"
		 								 value="Cancel"
		 								 action="/admin/adminPanel?faces-redirect=true&amp;i=2" />
		 			</p:toolbarGroup>
		 			<p:toolbarGroup align="right">
		 				<p:commandButton ajax="true"
		 								 process="@this, newRoute-form"
		 								 update="newRoute-form"
		 								 value="Next"
		 								 actionListener="#{RouteAction.step}">
		 					<p:collector unique="true" value="#{RouteAction.selectedEntity.start}" removeFrom="#{RouteAction.stationList}" />				 
					 	</p:commandButton>
		 			</p:toolbarGroup>
		 		</p:toolbar>
		 	</p:panel>
		 	
		 	<p:panel id="step2" header="Specify final destination" rendered="#{RouteAction.currentStep eq 1}" style="margin-top: 70px;">
		 		<p:selectOneMenu id="newRoute-stop" value="#{RouteAction.selectedEntity.stop}" converter="#{StopVOConverter}">
		 			<f:selectItems value="#{RouteAction.stationList}"
	 							   var="stop"
	 							   itemValue="#{stop}"
	 							   itemLabel="#{stop}" />
			   		<p:ajax process="step2" update="newRoute-form"/>
		 		</p:selectOneMenu>
		 		
		 		<p:toolbar style="border: none; margin-top: 5px;">
		 			<p:toolbarGroup align="left">
		 				<p:commandButton process="@this"
		 								 update="newRoute-form"
		 								 value="Prev"
		 								 actionListener="#{RouteAction.step}">
					 		<p:collector unique="true" value="#{RouteAction.selectedEntity.start}" addTo="#{RouteAction.stationList}" />
				 		</p:commandButton>						 
		 			</p:toolbarGroup>
		 			<p:toolbarGroup align="right">
		 				<p:commandButton process="@this, newRoute-form"
		 								 update="newRoute-form"
		 								 value="Next"
		 								 actionListener="#{RouteAction.step}">
				 			<p:collector unique="true" value="#{RouteAction.selectedEntity.start}" removeFrom="#{RouteAction.stationList}" />
				 			<p:collector unique="true" value="#{RouteAction.selectedEntity.stop}" removeFrom="#{RouteAction.stationList}" />
				 		</p:commandButton>
						 
		 			</p:toolbarGroup>
		 		</p:toolbar>
		 	</p:panel>
			
			<p:panel id="step3" header="Transit stations" rendered="#{RouteAction.currentStep eq 2}" style="margin-top: 70px;">
				<p:pickList id="transitStations-picklist"
							style="width: 600px;"
							value="#{RouteAction.stationPickList}"
							var="stop"
							itemLabel="#{stop}"
							itemValue="#{stop}"
							converter="#{StopVOConverter}" />
							
				<p:toolbar style="border: none; margin-top: 5px;">
		 			<p:toolbarGroup align="left">
		 				<p:commandButton process="@this"
		 								 update="newRoute-form"
		 								 value="Prev"
		 								 actionListener="#{RouteAction.step}">
				 			<p:collector unique="true" value="#{RouteAction.selectedEntity.stop}" addTo="#{RouteAction.stationList}" />
				 		</p:commandButton>						 
		 			</p:toolbarGroup>
		 			<p:toolbarGroup align="right">
		 				<p:commandButton process="@this, newRoute-form"
		 								 update="newRoute-form"
		 								 value="Next"
		 								 actionListener="#{RouteAction.step}" />
						 
		 			</p:toolbarGroup>
		 		</p:toolbar>
			</p:panel>
			
			<p:panel id="step44" header="Re-order transit stations" rendered="#{RouteAction.currentStep eq 3}" style="margin-top: 70px;">
				<p:orderList value="#{RouteAction.transitStationList}"
							 var="station"
							 converter="#{StationConverter}"
							 controlsLocation="left"
							 responsive="true"
							 itemValue="#{station}">
					 
		 			<p:ajax event="reorder" listener="#{RouteAction.onReorder}" update="step44"/>
		 			<p:ajax event="select" listener="#{RouteAction.onSelect}" update="step44"/>
					 		
		 			<p:column style="width: 200px;">
		 				<h:outputText value="Transit station ##{station.index + 1}"/>
		 			</p:column>
		 			
		 			<p:column>
		 				<h:outputText value="#{station}"/>
		 			</p:column>		
				</p:orderList>
				
				<p:toolbar style="border: none; margin-top: 5px;">
		 			<p:toolbarGroup align="left">
		 				<p:commandButton process="@this"
		 								 update="newRoute-form"
		 								 value="Prev"
		 								 actionListener="#{RouteAction.step}" />				 								 
		 			</p:toolbarGroup>
		 			<p:toolbarGroup align="right">
		 				<p:commandButton process="@this, step44"
		 								 update="newRoute-form"
		 								 value="Next"
		 								 actionListener="#{RouteAction.step}">
							<f:actionListener binding="#{RouteGraphAction.init()}"/>
							<f:actionListener binding="#{RouteGraphAction.onPageLoad()}"/>	 
			 			</p:commandButton>						 
		 			</p:toolbarGroup>
		 		</p:toolbar>
			</p:panel>
			
			<p:panel id="step5" header="Configure travel time estimates" rendered="#{RouteAction.currentStep eq 4}" style="margin-top: 70px;">
				<p:messages autoUpdate="true" closable="true" severity="info,error"/>
				
				<c:set var="curIndex" value="#{RouteGraphAction.currentIndex}" />
				<c:set var="graphLen" value="#{RouteGraphAction.allRouteStationList.size()}" />
				<c:set var="done" value="#{graphLen eq (curIndex + 1)}" />
				
				<p:panelGrid columns="1" layout="grid" rendered="#{not done}">
					
					<f:facet name="header">
						<h:panelGrid columns="4" width="100%">
							<h:outputLabel value="From:"/>
							<h:outputText value="#{RouteGraphAction.allRouteStationList[curIndex]}" style="background: #FFFFFF;"/>
							
							<h:outputLabel value="To:"/>
							<h:outputText value="#{RouteGraphAction.allRouteStationList[curIndex + 1]}" style="background: #FFFFFF;"/>
						</h:panelGrid>
					</f:facet>
					
					<h:panelGrid columns="2" cellpadding="10" cellspacing="10">
						<h:outputLabel value="Estimated travel time *" for="travel-time"/>
						<p:calendar id="travel-time"
									value="#{RouteGraphAction.selectedEntity.estimatedTravelTime}"
									timeOnly="true"
									required="true"
									mask="99:99"
									size="10"
									pattern="HH:mm">
							<p:ajax event="change" />			
						</p:calendar>									
					</h:panelGrid>
					
					<f:facet name="footer">
						<div align="center">
							<h:outputLabel value="Transit distance #{curIndex + 1}/#{graphLen}"/>
						</div>
					</f:facet>
				</p:panelGrid>
				
				<p:toolbar style="border: none; margin-top: 2px;">
					<p:toolbarGroup align="left">
						<p:commandButton id="btn-reset"
										 ajax="true" 
										 value="Reset" 
										 icon="ui-icon-close" 
										 process="@this"
										 update="step5"
										 actionListener="#{RouteGraphAction.onPageLoad}">
							<f:actionListener binding="#{RouteGraphAction.init()}"/>				 
						 </p:commandButton>
					</p:toolbarGroup>
					
					<p:toolbarGroup align="left">
						<p:commandButton id="btn-add" value="Add" icon="ui-icon-plus" process="@this, step5" update="step5">
							<f:actionListener binding="#{RouteGraphAction.addToEntityList()}"/>
						</p:commandButton>
					</p:toolbarGroup>
				</p:toolbar>
				
				<p:outputPanel id="routeGraph-panel" style="margin-top: 15px;">
					<p:dataTable value="#{RouteGraphAction.entityList}"
								 var="entity"
								 id="routeGraph-table"
								 styleClass="routeGraphTable-class">
						<p:column headerText="From">
							<h:outputText value="#{entity.from}"/>
						</p:column>
						
						<p:column headerText="To">
							<h:outputText value="#{entity.to}"/>
						</p:column>
						
						<p:column headerText="TRavel time">
							<h:outputText value="#{entity.estimatedTravelTimeAsString}"/>
						</p:column>
						
						<p:column headerText="Action">
							<p:commandLink value="Remove"
										   update="routeGraph-table, @form"
										   process="@this"
										   disabled="#{entity.selected}">
								<p:collector unique="true" value="#{entity}" removeFrom="#{RouteGraphAction.entityList}" />
								<f:setPropertyActionListener value="#{curIndex - 1}" target="#{RouteGraphAction.currentIndex}" />
								<f:actionListener binding="#{RouteGraphAction.activateLast()}"/>		   
				   			</p:commandLink>
						</p:column>		 
					 </p:dataTable>
				</p:outputPanel>
				
				<p:toolbar style="border: none; margin-top: 15px;">
					<p:toolbarGroup align="left">
						<p:commandButton value="Prev"
										 actionListener="#{RouteAction.step}"
										 process="@this"
										 update="newRouteForm"/>
					</p:toolbarGroup>
					<p:toolbarGroup align="right">
						<p:commandButton value="Next"
										 actionListener="#{RouteAction.step}"
										 process="@this, step5"
										 update="newRouteForm"
										 rendered="#{done}" />
					</p:toolbarGroup>
				</p:toolbar>
			</p:panel>
			
			<p:panel id="step6" header="Confirm route details" rendered="#{RouteAction.currentStep eq 5}" style="margin-top: 70px;">
				<p:tabView>
					<p:tab title="Route details">				
						<p:panelGrid columns="3" layout="grid">
							<p:panel header="Loading station" style="border: none;">
								<p:toolbar style="border: none;">
									<f:facet name="left">
										<h:outputText value="#{RouteAction.selectedEntity.start.description}" styleClass="confirmFont"/>
									</f:facet>
								</p:toolbar>
							</p:panel>
							
							<p:panel header="Final destination" style="border: none;">
								<p:toolbar style="border: none;">
									<f:facet name="left">
										<h:outputText value="#{RouteAction.selectedEntity.stop.description}" styleClass="confirmFont"/>
									</f:facet>
								</p:toolbar>
							</p:panel>
							
							<p:panel header="Transit stations" style="border: none;">
								<ui:repeat value="#{RouteAction.stationPickList.target}" var="stop" varStatus="counter">
									<p:toolbar style="border: none;">
										<f:facet name="left">
											<h:outputText value="#{counter.index + 1})  #{stop}" styleClass="confirmFont"/>
										</f:facet>
									</p:toolbar>
								</ui:repeat>
							</p:panel>
						</p:panelGrid>
					</p:tab>
					<p:tab title="Travel times between stations">
						<p:dataTable value="#{RouteGraphAction.entityList}"
									 var="graph"
									 paginator="true"
									 paginatorPosition="bottom"
									 rows="10">
							<p:column headerText="From">
								<h:outputText value="#{graph.from}"/>
							</p:column>
							
							<p:column headerText="To">
								<h:outputText value="#{graph.to}"/>
							</p:column>
							
							<p:column headerText="Travel time">
								<h:outputText value="#{graph.estimatedTravelTimeAsString}"/>
							</p:column>			 
						 </p:dataTable>
					</p:tab>
				</p:tabView>
				
				<p:toolbar style="border: none; margin-top: 5px;">
		 			<p:toolbarGroup align="left">
		 				<p:commandButton process="@this"
		 								 update="newRoute-form"
		 								 value="Prev"
		 								 actionListener="#{RouteAction.step}" />						 
		 			</p:toolbarGroup>
		 			<p:toolbarGroup align="right">
		 				<p:commandButton process="@this"		 								 
		 								 value="Finish"
		 								 actionListener="#{RouteAction.saveEntity}" />
						 
		 			</p:toolbarGroup>
		 		</p:toolbar>
			</p:panel>
			
		</h:form>
		
		<style>
			.ui-steps.custom { margin-bottom: 30px; }			
			.ui-steps.custom .ui-steps-item .ui-menuitem-link { height: 10px; padding: 0 1em; }			
			.ui-steps.custom .ui-steps-item .ui-steps-number {
				background-color: #0081c2;
				color: #FFFFFF;
				display: inline-block;
				width: 30px;
				border-radius: 10px;
				margin-top: -10px;
				margin-bottom: 10px;
				margin-bottom: 10px;
			}
			.ui-pickList .ui-pickList-list { width: 580px !important; }
			
			.confirmFont { font-size: 12pt; font-weight: normal; }
		</style>
	
	</ui:define>
				
</ui:composition>